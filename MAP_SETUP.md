# راه‌اندازی نقشه در تب Shifts

این فایل راهنمای راه‌اندازی نقشه نشان در تب shifts است.

## مراحل راه‌اندازی

### 1. اجرای Migration برای اضافه کردن فیلدهای مختصات

ابتدا باید فیلدهای `latitude` و `longitude` را به جدول `shifts` اضافه کنید:

```bash
cd backend
psql -U postgres -d karju_db -f database/migrations/add_shift_coordinates.sql
```

یا اگر از script setup استفاده می‌کنید، migration را به setup-database.js اضافه کنید.

### 2. تنظیم متغیرهای محیطی

در فایل `.env` بک‌اند، کلیدهای API نشان را اضافه کنید:

```env
NESHAN_GEOCODING_API_KEY=service.97ea0c4470274ff08e78ddfdde6aa9c9
NESHAN_MAP_API_KEY=web.61b9bb8eea274757b507bffff4c06575
```

### 3. نصب وابستگی‌های جدید

در بک‌اند، axios را نصب کنید:

```bash
cd backend
npm install
```

### 4. به‌روزرسانی شیفت‌های موجود

برای شیفت‌های موجود که مختصات ندارند، می‌توانید یک script برای geocoding دسته‌ای بنویسید یا به صورت خودکار در زمان به‌روزرسانی انجام شود.

### 5. تست

1. یک شیفت جدید ایجاد کنید و آدرس را وارد کنید
2. بررسی کنید که مختصات در دیتابیس ذخیره شده باشد
3. به صفحه `/shifts` بروید و نقشه را مشاهده کنید

## ویژگی‌های پیاده‌سازی شده

- ✅ ذخیره خودکار مختصات هنگام ایجاد/به‌روزرسانی شیفت
- ✅ نمایش نقشه با tile layer نشان
- ✅ نمایش مارکرها برای هر شیفت
- ✅ تعامل بین نقشه و لیست (کلیک روی مارکر → اسکرول به شیفت در لیست)
- ✅ Highlight کردن شیفت انتخاب شده
- ✅ Toggle بین نمایش نقشه و لیست

## نکات مهم

- اگر geocoding برای یک آدرس ناموفق باشد، فیلدهای latitude/longitude به صورت null ذخیره می‌شوند
- فقط شیفت‌هایی که مختصات معتبر دارند روی نقشه نمایش داده می‌شوند
- نقشه به صورت پیش‌فرض نمایش داده می‌شود، اما می‌توان با دکمه "نقشه" آن را toggle کرد

